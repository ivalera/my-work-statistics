<div class="task-container">
  <p-toast position="top-right"></p-toast>
  
  <div class="header">
    <h2>Доски и задачи</h2>
    <div class="controls">
      <div class="input-group">
        <div class="space-input">
          <span class="p-input-icon-right">
            <i class="pi pi-hashtag"></i>
            <input
              pInputText
              type="number"
              [(ngModel)]="spaceId"
              placeholder="Введите ID пространства"
              (keyup.enter)="loadBoards()"
            />
          </span>
        </div>
        <div class="username-input">
          <span class="p-input-icon-right">
            <i class="pi pi-user"></i>
            <input
              pInputText
              type="text"
              [(ngModel)]="username"
              placeholder="Введите имя пользователя"
              (keyup.enter)="loadBoards()"
            />
          </span>
        </div>
        <p-button label="Загрузить доски" icon="pi pi-refresh" (onClick)="loadBoards()"></p-button>
      </div>
      <p-button label="Выйти" icon="pi pi-sign-out" severity="danger" (onClick)="logout()"></p-button>
    </div>
    
    <div class="total-hours" *ngIf="totalHours > 0">
      <span class="label">Всего часов в колонке "Готово":</span>
      <span class="value">{{ totalHours }}h</span>
    </div>
    
    <div class="controls-row">
      <div class="sort-controls">
        <p-button
          [label]="isAscending ? 'По возрастанию' : 'По убыванию'"
          [icon]="isAscending ? 'pi pi-sort-amount-up' : 'pi pi-sort-amount-down'"
          (onClick)="toggleSortOrder()"
        ></p-button>
      </div>
      <div class="export-controls">
        <p-button
          label="Экспорт в Excel"
          icon="pi pi-file-excel"
          severity="success"
          (onClick)="exportToExcel()"
        ></p-button>
      </div>
    </div>
  </div>
  
  <div class="boards-list">
    <div *ngIf="loading" class="loading-overlay">
      <span class="loading-text">Загрузка данных...</span>
    </div>
    
    <div *ngFor="let board of boards" class="board-card">
      <p-card>
        <ng-template pTemplate="header">
          <div class="board-header">
            <h3 class="board-title">{{ board.title }}</h3>
          </div>
        </ng-template>
        <div class="columns-container">
          <div *ngFor="let column of getSortedColumns(board.columns)" class="column">
            <div class="column-header">
              <h4 class="column-title">{{ column.title }}</h4>
            </div>
            
            <div class="column-cards">
              <div *ngIf="!getColumnCards(board.id, column.id)?.length" class="no-cards">
                Нет задач
              </div>
              <app-task-card
                *ngFor="let card of getColumnCards(board.id, column.id)"
                [card]="card"
              ></app-task-card>
            </div>
          </div>
        </div>
      </p-card>
    </div>
  </div>
</div> 